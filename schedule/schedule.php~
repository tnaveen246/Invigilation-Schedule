<!DOCTYPE html>
<html>
	<head>
		<title>shedule</title>
     	<script>
     	function disable(x) 
     	{
			if(x==2)
    			document.getElementById("inter").disabled=true;
			else
    			document.getElementById("inter").disabled=false;
		}
		</script>
	<style>
		table {
			border-collapse: collapse;
		}
	</style>
 	</head>
	<body>
		<h2><center>SHEDULE</center><h2>
		<form action="#" method="post">
			year:<select name="year">
					<option value="1">1st year</option>
					<option value="2">2nd year</option>
					<option value="3">3rd year</option>
					<option value="4">4th year</option>
				</select>
			sem:<select name="sem">
					<option value="1">1st sem</option>
					<option value="2">2nd sem</option>
				</select>
			exam type:<select onclick="disable(this.value)"name="type">
					<option value="1">internal</option>
					<option value="2">semister</option>
				</select>
				internal:<select id="inter" name="mid">
					<option value="1">1st mid</option>
					<option value="2">2nd mid</option>
				</select>
			exam time:<input type="time" name="time">
			number of days:<input type="text" name="days">
				<input type="submit" name="submit"/>
		</form>
	</body>
</html>
<?php
	error_reporting(0);
	$server="localhost";
	$username="root";
	$password="";
	$dbname = "employeedb";
	$conn = new mysqli($server, $username, $password,$dbname);

	if ($conn->connect_error) {
    		die("Connection failed: " . $conn->connect_error);
	}
	if(isset($_POST['submit']))
	{
		$val1 = mysqli_real_escape_string($conn,$_POST['year']);
		$val2 = $_POST['sem'];
		$val3 = $_POST['type'];
		$val4 = mysqli_real_escape_string($conn,$_POST['days']);
		$time = $_POST['time'];
		if($time==''||$val4=='')
   			die('please enter time & date');
		echo "year :" .$val1." sem : ".$val2." exam type : ".$val3." days : ".$val4." Year : ".$time;
		
		$qry=$conn->query("INSERT INTO selected VALUES ('$val4','$val1','$time')");
		
		echo "<form action='printinf.php' method='post'>";
		echo "<table border='1' cellspacing='3' cellpadding='4'>";
			echo "<tr>";
				echo "<th>EMP_ID</th>";
				echo "<th>EMP_NAME</th>";
		for($i=100;$i<$val4+100;$i++)
			echo "<th><input type='date' name='$i'/></th>";
		echo "</tr>";
		$sql1 = "SELECT ID,NAME FROM emp where YEAR=".$val1."";
		$result = $conn->query($sql1);
		if ($result->num_rows > 0) {
    			while($row = $result->fetch_assoc()) 
    			{
        			echo "<tr><th>".$row["ID"]."</th><td>".$row['NAME']."</td>";
        			for($i=100; $i<$val4+100;$i++)
        			{
        				$k=$row['ID'].$i;
					echo "<th><input type='checkbox' name='$k' value='checked'/></th>";
				}
				echo "</tr>";
    			}
		} 
		else 
		{
    			echo "0 results";
		}
		echo "</table>";
		echo "<input type='submit' name='list'>";
		echo "</form>";
	}
	if(isset($_POST['list']))
	{
		$qry=$conn->query("SELECT * from selected");
		if ($qry->num_rows > 0) 
		{
    		while($row = $qry->fetch_assoc())
    		{
    			$year=$row['year'];
   				$days=$row['days'];
   				$time=$row['time'];
   				//echo $val.'</br>'.$days.'</br>time : '.$time;
   			}
    	}
    	else
			echo "no rows";
    	$result = $conn->query("SELECT ID,NAME FROM emp where YEAR=$year");
    	echo "<form action='printinf.php' method='post'>";
   		if($result->num_rows>0)
   		{
   			echo "<table border='1' cellspacing='3' cellpadding='4'>";
   			echo "<tr>
   					<th>EMP_ID</th>
   					<th>EMP_NAME</th>";
   			for($i=100;$i<100+$days;$i++){
   				if($_POST[$i]=='')
   					die('please select date');
   				else
					echo "<th>".$_POST[$i]."</th>";
   			}
   			echo"</tr>";
   			while($ro = $result->fetch_assoc())
   			{
   				$pin=$ro['ID'];
   				$name=$ro['NAME'];
   				$count=0;
  
				for($i=100;$i<$days+100;$i++)
				{
					$j=$pin.$i;
					if($_POST[$j])
					{
						echo "<tr><td>".$pin."</td><td>".$name."</td>";
						$count++;
						break;
					}
				}
				if($count>0)
				{
					for($i=100;$i<$days+100;$i++)
					{
						$j=$pin.$i;
						if($_POST[$j])
						{
							echo "<td>".$time."</td>";
						}
						else
							echo "<td></td>";
					}
					echo "</tr>";
				}	
			}
		}
		echo "</table>";
		echo "<input type='submit'>";
		echo "</form>";
	}

?>
